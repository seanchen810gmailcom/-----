# 敲磚塊遊戲 - AI 編程助手指南

## 🎯 項目概述

這是一個使用 Pygame 開發的模組化敲磚塊遊戲，具有 TNT 爆炸機制和特效系統。項目採用面向對象設計，將遊戲邏輯、視覺效果和配置分離。

## 🏗️ 核心架構

### 模組分層設計

- **`config.py`**: 集中式配置管理，所有遊戲參數都在這裡
- **`main_new.py`**: 遊戲入口點和主循環，處理 Pygame 初始化
- **`game/`**: 核心遊戲模組包，包含四個關鍵子模組：
  - `objects.py`: 遊戲實體類（Brick, Paddle, Ball）
  - `game_logic.py`: 狀態管理和遊戲流程控制
  - `effects.py`: 視覺特效系統（爆炸、碎片、彩蛋）
  - `utils.py`: 純函數工具（TNT 爆炸邏輯、碎片生成）

### 關鍵設計模式

- **配置驅動**: 所有硬編碼值都存放在 `config.py` 中的字典結構
- **狀態機**: `GameState` 類管理遊戲狀態（PLAYING, PAUSED, GAME_OVER）
- **依賴注入**: 工具函數接受對象作為參數而非使用全局變量

## 🎮 重要功能系統

### TNT 爆炸機制

- 使用 BFS（廣度優先搜索）處理連鎖爆炸
- 爆炸邏輯在 `utils.py` 的 `explode_tnt()` 函數中
- 倒計時和視覺效果在 `Brick` 類的 `update_tnt()` 方法中

### 特效系統

- 所有視覺特效都是獨立的類，有 `update()` 和 `draw()` 方法
- 粒子系統使用重力和空氣阻力物理模擬
- 特效對象存放在遊戲狀態的列表中統一管理

### 配置系統

每個功能模組都有對應的配置字典：

```python
BRICK_CONFIG = {...}    # 磚塊設置
TNT_CONFIG = {...}      # TNT 爆炸設置
EFFECTS_CONFIG = {...}  # 特效參數
```

## 🛠️ 開發工作流

### 運行遊戲

```bash
python main_new.py  # 使用重構後的主程式
# 或
python main.py      # 原始版本（保留參考）
```

### 依賴管理

- 核心依賴：`pygame>=2.1.0`
- 開發工具：`black`, `flake8`, `isort` (在 requirements.txt 中)
- 安裝：`pip install -r requirements.txt`

### 程式碼約定

- **中文註釋**: 類別和函數都使用中文文檔字符串
- **類型提示**: 雖然未強制，但建議添加參數類型
- **命名規範**:
  - 類別使用 PascalCase（`GameState`）
  - 函數和變量使用 snake_case（`explode_tnt`）
  - 常數使用 UPPER_CASE（`TNT_CONFIG`）

## 🔧 常見修改模式

### 添加新磚塊類型

1. 在 `config.py` 中添加新的配置字典
2. 修改 `Brick` 類添加新屬性和行為
3. 在 `utils.py` 的 `initialize_bricks()` 中添加生成邏輯

### 修改遊戲參數

- 編輯 `config.py` 中對應的配置字典
- 無需修改其他文件，系統會自動應用新參數

### 添加新特效

1. 在 `effects.py` 中創建新類，實現 `update()` 和 `draw()` 方法
2. 在觸發位置調用特效創建函數
3. 將特效對象添加到 `GameState` 的特效列表中

### 音效集成

- 音效文件放在 `assets/sounds/` 目錄
- 在各個類別的構造函數中載入音效
- 使用 try-except 包裝音效載入以處理文件不存在的情況

## ⚠️ 重要注意事項

### 檔案結構

- **不要** 混淆 `main.py`（原始版本）和 `main_new.py`（重構版本）
- 測試運行時優先使用 `main_new.py`
- 所有新功能都應基於重構後的模組架構

### 狀態管理

- 遊戲狀態改變必須通過 `GameState` 類的方法
- 避免直接修改 `GameState` 的屬性
- 使用狀態機模式確保遊戲流程的正確性

### 效能考量

- 特效對象會累積，需要及時清理過期的特效
- TNT 連鎖爆炸使用 BFS 避免遞迴深度問題
- 碰撞檢測使用簡單的矩形邊界檢查

### 資源路徑

- 音效和圖片資源使用相對路徑
- 使用 `os.path.join()` 確保跨平台兼容性
- 資源載入失敗時有適當的回退機制

## 🔍 除錯技巧

### 啟用除錯模式

在 `config.py` 中設置：

```python
GAME_CONFIG = {
    "SHOW_DEBUG_INFO": True,  # 顯示碰撞邊界等除錯信息
}
```

### 常見問題排查

- **音效無法播放**: 檢查 `pygame.mixer` 初始化和文件路徑
- **TNT 不爆炸**: 確認 `tnt_primed` 狀態和倒計時邏輯
- **特效不顯示**: 檢查特效對象是否正確添加到更新列表
- **配置不生效**: 確認是否重新運行程式以載入新配置

這個架構優先考慮可維護性和擴展性，所有新功能都應遵循現有的模組化設計模式。
